---
title: 什么是覆盖索引，一篇文章告诉你
date: 2023-08-02 14:17:02
tags: MySQL
---



# 什么是覆盖索引，一篇文章告诉你

首先，先来看下覆盖索引的概念： 覆盖索引是指 **查询使用了索引，并且需要返回的列，在该索引中已经全部能够找到** 

 接下来，我们来看一组SQL的执行计划，看看执行计划的差别，然后再来具体做一个解析。  

```plsql
explain select id, profession 								 from tb_user where profession = '软件工程' and age = 31 and status = '0' ;
explain select id,profession,age, status 			 from tb_user	where profession = '软件工程' and age = 31 and status = '0' ;
explain select id,profession,age, status, name from tb_user where profession = '软件工程' and age = 31 and status = '0' ;
explain select * 															 from tb_user where profession = '软件工程' and age = 31 and status = '0' ;
```

可以发现他们只有查询出来的字段不一样。

然后我们可以看一下他们的explain分析

![img](../pic/%E4%BB%80%E4%B9%88%E6%98%AF%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%EF%BC%8C%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%91%8A%E8%AF%89%E4%BD%A0/1690955845816-f7ee30c4-6e46-469d-9692-79b9c382f45d.png)

具体extra的分析：

![img](../pic/%E4%BB%80%E4%B9%88%E6%98%AF%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%EF%BC%8C%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%91%8A%E8%AF%89%E4%BD%A0/1690955884747-9a83c2b0-ecaa-4f90-a1f9-84aff13291d9.png)

因为，在tb_user表中有一个联合索引 idx_user_pro_age_sta，该索引关联了三个字段 profession、age、status，而这个索引也是一个二级索引，所以叶子节点下面挂的是这一行的主 键id。 所以当我们查询返回的数据在 id、profession、age、status 之中，则直接走二级索引 直接返回数据了。 如果超出这个范围，就需要拿到主键id，再去扫描聚集索引，再获取额外的数据了，这个过程就是回表。 而我们如果一直使用select * 查询返回所有字段值，很容易就会造成回表查询（除非是根据主键查询，此时只会扫描聚集索引）。  
